[toc]

## I/O设备管理

I/O设备即输入/输出设备，是用于计算机系统与人通信或与其他机器通信的所有设备，以及所有外存设备

### 1. I/O系统的组成

I/O系统不仅包括各种I/O设备，还包括与设备相连的设备控制器，有些系统还配备了专门用于输入/输出控制的专用计算机，即<font style=color:red>通道</font>。此外，<font style=color:red>I/O系统要通过总线与CPU、内存相连</font>。

#### 1.1 I/O系统的结构

##### 微机I/O系统（总线型I/O系统）

在DMA出现以前，<font style=color:red>必须通过CPU申请总线权限后才能访问内存</font>。

![image-20220929084317788](images/image-20220929084317788.png)

##### 主机I/O系统

![image-20220929084348208](images/image-20220929084348208.png)



#### 1.2 I/O设备的分类

![image-20220929084609737](images/image-20220929084609737.png)



#### 1.3 设备控制器

##### 简介

控制器是可编址的设备，因为<font style=color:red>CPU是根据地址去访问资源的</font>，所以发送的就是一个设备的地址。

![image-20220929084824812](images/image-20220929084824812.png)

##### 功能

控制器是<font style=color:red>可编址的设备</font>，因为CPU是根据地址去访问资源的，所以发送的就是一个设备的地址。

![image-20220930004510466](images/image-20220930004510466.png)

##### 组成

![image-20220929084925451](images/image-20220929084925451.png)



#### 1.4 I/O通道

##### 简介

​			![image-20220930001928874](images/image-20220930001928874.png)



### 2. I/O控制方式

I/O控制方式的发展，经历了以下四种方式。

![image-20220930005217802](images/image-20220930005217802.png)

#### 2.1 轮询控制

![image-20220930005359229](images/image-20220930005359229.png)



#### 2.2 中断控制

##### 原理

![image-20220930005925993](images/image-20220930005925993.png)

![image-20220930010003361](images/image-20220930010003361.png)



#### 2.3 DMA控制（直接存储控制）

在DMA出现以前，<font style=color:red>必须通过CPU申请总线权限后才能访问内存</font>。现在外围设备可以通过  <font style=color:red>DMA技术 </font> 来访问内存。

##### DMA控制器结构

![image-20220930011712476](images/image-20220930011712476.png)

##### DMA控制器中的寄存器

为了实现主机与设备控制器之间成块数据的传送，在DMA控制器中设计了4类寄存器：

![image-20220930012418600](images/image-20220930012418600.png)

##### DMA工作原理

![image-20220930012921284](images/image-20220930012921284.png)

![image-20220930013418506](images/image-20220930013418506.png)





### 3. 缓冲管理

#### 3.1 缓冲区

缓冲区是用来 <font style=color:red>保存</font> **两个设备之间** 或 **设备与应用程序之间** 传输 <font style=color:red>数据的内存区域</font>

由于 **CPU** 的速度**远远高于I/O设备**，为了 **尽可能使CPU与设备并行工作**，**提高系统的性能**，通常需要操作系统在设备管理软件中提供缓冲区管理功能

#### 3.2 引入缓冲的原因

**在数据到达速率与数据离去速率不同的地方，都可以引入缓冲区**

- 处理数据流的 <font style=color:red>生产者与消费者之间的速度差异</font>
- 协调传输 <font style=color:red>数据大小不一致</font> 的设备

#### 3.3 引入缓冲的主要作用

引入缓冲区除了可以  <font style=color:red>缓和CPU与I/O设备之间速度不匹配</font>  的矛盾，还能 <font style=color:red>提高CPU和I/O设备之间的并行性</font>。

#### 3.4 缓冲池

![image-20221001022421718](images/image-20221001022421718.png)

#### 3.5 单缓冲

![image-20221001021457318](images/image-20221001021457318.png)

#### 3.6 双缓冲（缓冲交换）

![image-20221001021509865](images/image-20221001021509865.png)

#### 3.7 循环缓冲

**在数据到达和数据离去的速度差别很大的情况下，需要增加缓冲区的数量**

![image-20221001021645646](images/image-20221001021645646.png)

##### 工作原理

![image-20221001021703808](images/image-20221001021703808.png)





### 4. 设备分配

#### 4.1 支持设备分配的数据结构

##### 设备控制表DCT

![image-20221001141320353](images/image-20221001141320353.png)

##### 控制器控制表COCT

![image-20221001141334392](images/image-20221001141334392.png)

##### 通道控制表CHCT

![image-20221001141340922](images/image-20221001141340922.png)

##### 系统设备表SDT

![image-20221001141347870](images/image-20221001141347870.png)



#### 4.2 设备分配的因素

##### 设备固有属性

独占性、共享性、可虚拟性

![image-20221001141823540](images/image-20221001141823540.png)

##### 分配算法

![image-20221001141807411](images/image-20221001141807411.png)

##### 分配方式

![image-20221001141749830](images/image-20221001141749830.png)



#### 4.3 设备独立性

##### 含义

![image-20221001141904735](images/image-20221001141904735.png)

##### 设备独立性的好处

![image-20221001141940933](images/image-20221001141940933.png)

##### 提供设备独立性的功能

![image-20221001142300407](images/image-20221001142300407.png)

##### 独立设备分配

- 分配设备
- 分配控制器
- 分配通道



#### 4.4 SPOOLing技术

##### 含义

![image-20221001234300678](images/image-20221001234300678.png)

##### 组成

![image-20221001235257789](images/image-20221001235257789.png)

##### 利用SPOOLing技术实现共享打印机

![image-20221001235520080](images/image-20221001235520080.png)

##### 特点

![image-20221001235629682](images/image-20221001235629682.png)





### 5. I/O软件原理（管理设备的软件）

![image-20221002101410164](images/image-20221002101410164.png)

##### 用户层I/O软件的功能

- 实现I/O设备的独立性
- 错误处理
- 异步传输
- 缓冲管理
- 设备的分配和释放
- 实现I/O控制方式

##### 与设备无关的I/O软件的功能

- 设备命名
- 设备保护
- 提供独立于设备的块大小
- 为块设备和字符设备提供必要的缓冲技术
- 块设备的存储分配
- 分配和释放独立设备
- 错误处理

##### 设备驱动程序

![image-20221002114835223](images/image-20221002114835223.png)

##### 中断处理程序

I/O中断处理程序的作用是 <font style=color:red>将发出I/O请求而被阻塞的进程唤醒</font>。





### 6. 磁盘管理

![image-20221002135045903](images/image-20221002135045903.png)

#### 6.1结构

![image-20221002135206123](images/image-20221002135206123.png)

##### 磁盘类型

![image-20221002135536847](images/image-20221002135536847.png)

##### 磁盘访问时间

![image-20221002135724019](images/image-20221002135724019.png)





#### 6.2 调度算法

磁盘调度的一个重要目标是  **使磁盘的平均寻道时间最少**。

##### 先来先服务FCFS

​		![image-20221002135939340](images/image-20221002135939340.png)

##### 最短寻道时间优先SSTF

​		![image-20221002140105132](images/image-20221002140105132.png)

##### 扫描算法SCAN（电梯调度算法）

​		![image-20221002140135382](images/image-20221002140135382.png)

##### 循环扫描算法CSCAN

​		![image-20221002140233711](images/image-20221002140233711.png)

##### NStepSCAN和FSCAN算法

​		![image-20221002140401633](images/image-20221002140401633.png)

##### FCFS和SSTF习题

​	![image-20221002140454759](images/image-20221002140454759.png)

![image-20221002140637234](images/image-20221002140637234.png)

![image-20221002140715625](images/image-20221002140715625.png)

##### SCAN和CSCAN习题

![image-20221002141030247](images/image-20221002141030247.png)

![image-20221002140933478](images/image-20221002140933478.png)

![image-20221002141046847](images/image-20221002141046847.png)



#### 6.3 提高磁盘I/O速度的方法

​	![image-20221002141118981](images/image-20221002141118981.png)